<template>
    <div class="col-md breadcrumbs">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="/org_dashboard">Dashboard</a>
                </li>
                <li class="breadcrumb-item">Student Organization</li>
                <li class="breadcrumb-item active" aria-current="page">
                    Events
                </li>
            </ol>
        </nav>
    </div>
    <div class="mt-2">
        <div class="row head-container">
            <div class="col-md-6 col-sm-12">
                <div class="input-container">
                    <i class="fa fa-search"></i>
                    <input type="text" placeholder="Search Event" v-model="searchTerm" @input="filterItems" />
                </div>
            </div>
            <div class="col-md-6 col-sm-12" style="
                    display: flex;
                    align-items: center;
                    justify-content: flex-end;
                    gap: 20px;
                ">
                <!-- <button class="btn sort-btn"><i class="bi bi-sort-up"></i></button> -->
                <div class="select-dropdown" style="width: 70%">
                    <select id="sort-select" class="form-control" style="text-align: center" v-model="school_year_input"
                        @change="fetchData">
                        <option value="0" disabled selected>
                            Select Semester
                        </option>
                        <option v-for="school_year in this.school_year" :value="school_year['id']">
                            {{ school_year["semester"] }}
                            {{ school_year["school_year"] }}
                        </option>
                    </select>
                </div>
                <div class="select-dropdown" style="width: 30%">
                    <select id="sort-select" class="form-control" style="text-align: center" v-model="status_filter"
                        @change="filterItems">
                        <option :value="''">All</option>
                        <option :value="0">New</option>
                        <option :value="1">Ongoing</option>
                        <option :value="2">Completed</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid" v-if="this.user_school_year == this.school_year_input">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="mt-2"><i class="fas fa-list"></i> Events</h3>
            <div class="event-buttons d-flex">
                <div class="btn-group" role="group">
                    <button class="btn btn-light me-2" id="add-event-button" data-bs-toggle="modal"
                        data-bs-target="#event-modal" @click="
                            this.initialData(), (this.submit = this.sendData)
                            ">
                        <i class="fas fa-calendar-plus"></i> Add Event
                    </button>
                    <button class="btn btn-light me-2" id="copy-event-button" data-bs-toggle="modal"
                        data-bs-target="#copy-modal">
                        <i class="fas fa-copy"></i> Copy existing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="event-list">
        <div class="col">
            <div>
                <div class="event-cards-list">
                    <!-- Loading spinner -->
                    <div v-if="loading">
                        <div class="d-flex flex-column flex-md-row gap-4">
                            <div class="card loading-card col-lg-4 col-md-6" aria-hidden="true" style="
                                    width: calc(33.33% - 30px);
                                    height: 200px;
                                    border: none;
                                    padding: 10px;
                                ">
                                <div class="">
                                    <p class="card-text placeholder-glow mt-2">
                                        <span class="placeholder col-8 bg-secondary"></span>
                                        <br />
                                        <span class="placeholder col-4 bg-secondary"></span>
                                        <br />
                                        <span class="placeholder col-6 bg-secondary"></span>
                                        <br />
                                        <span class="placeholder col-4 bg-secondary"></span>
                                    </p>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" tabindex="-1"
                                            class="btn btn-secondary mt-2 disabled placeholder col-6"
                                            style="height: 35px; width: 70px"></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card loading-card col-lg-4 col-md-6" aria-hidden="true" style="
                                    width: calc(33.33% - 30px);
                                    height: 200px;
                                    border: none;
                                    padding: 10px;
                                ">
                                <div class="">
                                    <p class="card-text placeholder-glow mt-2">
                                        <span class="placeholder col-8 bg-secondary"></span>
                                        <br />
                                        <span class="placeholder col-4 bg-secondary"></span>
                                        <br />
                                        <span class="placeholder col-6 bg-secondary"></span>
                                        <br />
                                        <span class="placeholder col-4 bg-secondary"></span>
                                    </p>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" tabindex="-1"
                                            class="btn btn-secondary mt-2 disabled placeholder col-6"
                                            style="height: 35px; width: 70px"></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card loading-card col-lg-4 col-md-6" aria-hidden="true" style="
                                    width: calc(33.33% - 30px);
                                    height: 200px;
                                    border: none;
                                    padding: 10px;
                                ">
                                <div class="">
                                    <p class="card-text placeholder-glow mt-2">
                                        <span class="placeholder col-8 bg-secondary"></span>
                                        <br />
                                        <span class="placeholder col-4 bg-secondary"></span>
                                        <br />
                                        <span class="placeholder col-6 bg-secondary"></span>
                                        <br />
                                        <span class="placeholder col-4 bg-secondary"></span>
                                    </p>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" tabindex="-1"
                                            class="btn btn-secondary mt-2 disabled placeholder col-6"
                                            style="height: 35px; width: 70px"></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Message if the container is empty -->
                    <div class="Container-IfEmpty text-center" v-if="!loading && this.events == 0">
                        <div class="Empty-Message">
                            <i class="icon bi bi-calendar-event mb-0" id="icon-message"></i>
                            <p class="text-muted mt-0">
                                <b>Create Events when you're ready</b>
                                <br />
                                No events yet.
                            </p>
                            <a v-if="this.user_school_year == this.school_year_input" class="btn btn-success"
                                id="copy-event-button" data-bs-toggle="modal" data-bs-target="#event-modal" @click="
                                    this.initialData(),
                                    (this.submit = this.sendData)
                                    ">Add Event</a>
                        </div>
                    </div>
                    <!-- Message No results found -->
                    <div class="Container-IfEmpty text-center" v-if="
                        !loading &&
                        this.filtered_events.length === 0 &&
                        this.events != 0
                    ">
                        <div class="Empty-Message">
                            <i class="icon fas fa-frown" id="icon-message"></i>
                            <p class="text-muted fw-bold">No results found</p>
                        </div>
                    </div>
                    <!-- <div class="recorded-event-cards"> -->
                    <!-- EVENT CARD -->
                    <!-- <div
                            v-for="event in filtered_events"
                            :key="event.event_id"
                            :id="event.event_id"
                            class="event-card"
                            :class="[
                                'border-top',
                                'border-5',
                                {
                                    'border-warning': event.event_status == 1,
                                    'border-success': event.event_status == 2,
                                },
                                'border-bottom-0',
                            ]"
                            :title="event.event_status == 1 ?
                                'Event is ongoing' :
                                event.event_status == 2 ?
                                'Event Completed' :
                                ''"
                        >
                            <div class="dropdown">
                                <a
                                    class="ellipsis-button"
                                    href="#"
                                    style="color: black"
                                    role="button"
                                    id="ellipsisDropdown"
                                    data-bs-toggle="dropdown"
                                    aria-expanded="false"
                                >
                                    <i class="fas fa-ellipsis-h"></i>
                                </a>
                                <ul
                                    class="dropdown-menu"
                                    aria-labelledby="ellipsisDropdown"
                                >
                                    <li>
                                        <a
                                            class="dropdown-item"
                                            @click="
                                                FetchUpdateData(event.event_id)
                                            "
                                            data-bs-toggle="modal"
                                            data-bs-target="#event-modal"
                                            >Edit Event</a
                                        >
                                    </li>
                                    <li>
                                        <a
                                            class="dropdown-item"
                                            @click="this.id = event.event_id"
                                            data-bs-toggle="modal"
                                            data-bs-target="#deleteConfirmation"
                                            >Delete Event</a
                                        >
                                    </li> -->
                    <!-- option 3 -->
                    <!-- <li v-if="this.college_id != 11"><a class="dropdown-item"
                                            @click="this.id = (event.event_id), this.showYearLevelExempted()"
                                            data-bs-toggle="modal" data-bs-target="#exemptModal">Select Exempted Year
                                            Level</a>
                                    </li> -->
                    <!-- <div
                                        v-if="
                                            event.event_status == 0 ||
                                            event.event_status == 2
                                        "
                                    >
                                        <li>
                                            <a
                                                class="dropdown-item"
                                                @click="
                                                    (this.id = event.event_id),
                                                        (this.status = 1)
                                                "
                                                data-bs-toggle="modal"
                                                data-bs-target="#eventStatus"
                                                >Start Event</a
                                            >
                                        </li>
                                    </div>
                                    <div v-else-if="event.event_status == 1">
                                        <li>
                                            <a
                                                class="dropdown-item"
                                                @click="
                                                    (this.id = event.event_id),
                                                        (this.status = 2)
                                                "
                                                data-bs-toggle="modal"
                                                data-bs-target="#eventStatus"
                                                >Stop Event</a
                                            >
                                        </li>
                                    </div>
                                    <div
                                        v-if="
                                            (event.attendance_status == 0 ||
                                                event.attendance_status == 2) &&
                                            event.event_status == 1 &&
                                            event.event_status != 0
                                        "
                                    >
                                        <li>
                                            <a
                                                class="dropdown-item"
                                                @click="
                                                    (this.attendance_count_start_attendance =
                                                        event.attendance_count),
                                                        (this.id =
                                                            event.event_id),
                                                        (this.status = 1)
                                                "
                                                data-bs-toggle="modal"
                                                data-bs-target="#startAttendanceModal"
                                                >Start Attendance</a
                                            >
                                        </li>
                                    </div>
                                    <div
                                        v-else-if="
                                            event.attendance_status == 1 &&
                                            event.event_status == 1 &&
                                            event.event_status != 0
                                        "
                                    >
                                        <li>
                                            <a
                                                class="dropdown-item"
                                                @click="
                                                    (this.attendance_count_start_attendance = 0),
                                                        (this.id =
                                                            event.event_id),
                                                        (this.status = 2)
                                                "
                                                data-bs-toggle="modal"
                                                data-bs-target="#stopAttendanceConfirmation"
                                                >Stop Attendance</a
                                            >
                                        </li>
                                    </div>

                                    <div>
                                        <li>
                                            <a
                                                class="dropdown-item"
                                                data-bs-toggle="modal"
                                                data-bs-target="#cancelAttendance"
                                                @click="
                                                    (this.id = event.event_id),
                                                        this.fetchCancelAttendanceEvent()
                                                "
                                                >Exclude Attendance log</a
                                            >
                                        </li>
                                    </div>
                                </ul>
                            </div>
                            <h5 class="card-title mt-4 mb-2">
                                <strong>{{ event['name'] }}</strong>
                            </h5>
                            <p class="card-subtitle text-muted">
                                Scheduled Date: {{ event['start_date'] }}
                            </p>
                            <p class="card-subtitle text-muted">
                                Start Time: {{ event['start_attendance'] }}
                            </p>
                            <p class="card-subtitle text-muted">
                                End Time: {{ event['end_attendance'] }}
                            </p>
                            <h6 class="card-text mb-0">
                                Location: {{ event['location'] }}
                            </h6>
                            <button
                                class="btn btn-success view-button"
                                @click="showEventDetails(event.event_id)"
                                data-bs-toggle="modal"
                                data-bs-target="#event-details-modal"
                            >
                                View
                            </button>
                        </div>
                        </div> -->

                    <div class="recorded-event-cards container-fluid">
                        <!-- New Events -->
                        <div class="col-12 accordion" id="eventAccordion">
                            <div class="accordion-item" v-if="newEvents.length > 0">
                                <h2 class="accordion-header" id="newEventsHeading">
                                    <button class="accordion-button bg-white border rounded" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#newEventsCollapse"
                                        aria-expanded="true" aria-controls="newEventsCollapse">
                                        <i class="fas fa-bars" style="padding-right: 5px"></i>
                                        New Events
                                    </button>
                                </h2>
                                <div id="newEventsCollapse" class="accordion-collapse collapse show"
                                    aria-labelledby="newEventsHeading">
                                    <div class="accordion-body">
                                        <div class="d-flex row">
                                            <div v-for="event in newEvents" :key="event.event_id"
                                                class="event-card col-md-4" :class="[
                                                    'border-top',
                                                    'border-5',
                                                    {
                                                        'border-secondary':
                                                            event.event_status ===
                                                            0,
                                                        'border-warning':
                                                            event.event_status ===
                                                            1,
                                                        'border-success':
                                                            event.event_status ===
                                                            2,
                                                    },
                                                    'border-bottom-0',
                                                ]" :title="event.event_status === 0
                                                    ? 'New Event'
                                                    : event.event_status ===
                                                        1
                                                        ? 'Ongoing Event'
                                                        : 'Completed Event'
                                                    ">
                                                <!-- Event card HTML -->
                                                <div class="card">
                                                    <div class="dropdown"
                                                        v-if="this.user_school_year == this.school_year_input">
                                                        <a class="ellipsis-button" href="#" style="color: black"
                                                            role="button" id="ellipsisDropdown"
                                                            data-bs-toggle="dropdown" aria-expanded="false">
                                                            <i class="fas fa-ellipsis-h"></i>
                                                        </a>
                                                        <ul class="dropdown-menu" aria-labelledby="ellipsisDropdown">
                                                            <li>
                                                                <a class="dropdown-item" @click="
                                                                    FetchUpdateData(
                                                                        event.event_id
                                                                    )
                                                                    " data-bs-toggle="modal"
                                                                    data-bs-target="#event-modal">Edit
                                                                    Event</a>
                                                            </li>
                                                            <li>
                                                                <a class="dropdown-item" @click="
                                                                    this.id =
                                                                    event.event_id
                                                                    " data-bs-toggle="modal"
                                                                    data-bs-target="#deleteConfirmation">Delete
                                                                    Event</a>
                                                            </li>
                                                            <!-- option 3 -->
                                                            <!-- <li v-if="this.college_id != 11"><a class="dropdown-item"
                                            @click="this.id = (event.event_id), this.showYearLevelExempted()"
                                            data-bs-toggle="modal" data-bs-target="#exemptModal">Select Exempted Year
                                            Level</a>
                                    </li> -->
                                                            <div v-if="
                                                                event.event_status ==
                                                                0 ||
                                                                event.event_status ==
                                                                2
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                    (this.id =
                                                                        event.event_id),
                                                                        (this.status = 1)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#eventStatus">Start
                                                                        Event</a>
                                                                </li>
                                                            </div>
                                                            <div v-else-if="
                                                                event.event_status ==
                                                                1
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                    (this.id =
                                                                        event.event_id),
                                                                        (this.status = 2)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#eventStatus">Stop
                                                                        Event</a>
                                                                </li>
                                                            </div>
                                                            <div v-if="
                                                                (event.attendance_status ==
                                                                    0 ||
                                                                    event.attendance_status ==
                                                                    2) &&
                                                                event.event_status ==
                                                                1 &&
                                                                event.event_status !=
                                                                0
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                    (this.attendance_count_start_attendance =
                                                                        event.attendance_count),
                                                                        (this.id =
                                                                            event.event_id),
                                                                        (this.status = 1)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#startAttendanceModal">Start
                                                                        Attendance</a>
                                                                </li>
                                                            </div>
                                                            <div v-else-if="
                                                                event.attendance_status ==
                                                                1 &&
                                                                event.event_status ==
                                                                1 &&
                                                                event.event_status !=
                                                                0
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                        (this.attendance_count_start_attendance = 0),
                                                                        (this.id =
                                                                            event.event_id),
                                                                        (this.status = 2)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#stopAttendanceConfirmation">Stop
                                                                        Attendance</a>
                                                                </li>
                                                            </div>

                                                            <div>
                                                                <li>
                                                                    <a class="dropdown-item" data-bs-toggle="modal"
                                                                        data-bs-target="#cancelAttendance" @click="
                                                                        (this.id =
                                                                            event.event_id),
                                                                            this.fetchCancelAttendanceEvent()
                                                                            ">Exclude
                                                                        Attendance
                                                                        log</a>
                                                                </li>
                                                            </div>
                                                        </ul>
                                                    </div>
                                                    <!-- Card content -->
                                                    <h5 class="card-title mt-4 mb-2">
                                                        <strong>{{
                                                            event.name
                                                            }}</strong>
                                                    </h5>
                                                    <p class="card-subtitle text-muted">
                                                        Scheduled Date:
                                                        {{ event.start_date }}
                                                    </p>
                                                    <p class="card-subtitle text-muted">
                                                        Start Time:
                                                        {{
                                                            event.start_attendance
                                                        }}
                                                    </p>
                                                    <p class="card-subtitle text-muted">
                                                        End Time:
                                                        {{
                                                            event.end_attendance
                                                        }}
                                                    </p>
                                                    <h6 class="card-text mb-0">
                                                        Location:
                                                        {{ event.location }}
                                                    </h6>
                                                    <div class="d-flex justify-content-end">
                                                        <button class="btn btn-success" @click="
                                                            showEventDetails(
                                                                event.event_id
                                                            )
                                                            " data-bs-toggle="modal"
                                                            data-bs-target="#event-details-modal">
                                                            <i class="fas fa-eye"></i>
                                                            View
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Ongoing Events -->
                        <div class="col-12 accordion" id="eventAccordion">
                            <div class="accordion-item" v-if="ongoingEvents.length > 0">
                                <h2 class="accordion-header" id="newEventsHeading">
                                    <button class="accordion-button bg-white border rounded" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#ongoingEventsCollapse"
                                        aria-expanded="true" aria-controls="ongoingEventsCollapse">
                                        <i class="fas fa-bars" style="padding-right: 5px"></i>
                                        Ongoing Events
                                    </button>
                                </h2>
                                <div id="ongoingEventsCollapse" class="accordion-collapse collapse show"
                                    aria-labelledby="ongoingEventsHeading">
                                    <div class="accordion-body">
                                        <div class="d-flex row">
                                            <div v-for="event in ongoingEvents" :key="event.event_id" class="event-card"
                                                :class="[
                                                    'border-top',
                                                    'border-5',
                                                    {
                                                        'border-secondary':
                                                            event.event_status ===
                                                            0,
                                                        'border-warning':
                                                            event.event_status ===
                                                            1,
                                                        'border-success':
                                                            event.event_status ===
                                                            2,
                                                    },
                                                    'border-bottom-0',
                                                ]" :title="event.event_status === 0
                                                    ? 'New Event'
                                                    : event.event_status ===
                                                        1
                                                        ? 'Ongoing Event'
                                                        : 'Completed Event'
                                                    ">
                                                <!-- Event card HTML -->
                                                <div class="card">
                                                    <div class="dropdown"
                                                        v-if="this.user_school_year == this.school_year_input">
                                                        <a class="ellipsis-button" href="#" style="color: black"
                                                            role="button" id="ellipsisDropdown"
                                                            data-bs-toggle="dropdown" aria-expanded="false">
                                                            <i class="fas fa-ellipsis-h"></i>
                                                        </a>
                                                        <ul class="dropdown-menu" aria-labelledby="ellipsisDropdown">
                                                            <li>
                                                                <a class="dropdown-item" @click="
                                                                    FetchUpdateData(
                                                                        event.event_id
                                                                    )
                                                                    " data-bs-toggle="modal"
                                                                    data-bs-target="#event-modal">Edit
                                                                    Event</a>
                                                            </li>
                                                            <li>
                                                                <a class="dropdown-item" @click="
                                                                    this.id =
                                                                    event.event_id
                                                                    " data-bs-toggle="modal"
                                                                    data-bs-target="#deleteConfirmation">Delete
                                                                    Event</a>
                                                            </li>
                                                            <!-- option 3 -->
                                                            <li v-if="
                                                                this
                                                                    .college_id !=
                                                                11
                                                            ">
                                                                <a class="dropdown-item" @click="
                                                                (this.id =
                                                                    event.event_id),
                                                                    this.showYearLevelExempted()
                                                                    " data-bs-toggle="modal"
                                                                    data-bs-target="#exemptModal">Select
                                                                    Exempted
                                                                    Year
                                                                    Level</a>
                                                            </li>
                                                            <div v-if="
                                                                event.event_status ==
                                                                0 ||
                                                                event.event_status ==
                                                                2
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                    (this.id =
                                                                        event.event_id),
                                                                        (this.status = 1)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#eventStatus">Start
                                                                        Event</a>
                                                                </li>
                                                            </div>
                                                            <div v-else-if="
                                                                event.event_status ==
                                                                1
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                    (this.id =
                                                                        event.event_id),
                                                                        (this.status = 2)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#eventStatus">Stop
                                                                        Event</a>
                                                                </li>
                                                            </div>
                                                            <div v-if="
                                                                (event.attendance_status ==
                                                                    0 ||
                                                                    event.attendance_status ==
                                                                    2) &&
                                                                event.event_status ==
                                                                1 &&
                                                                event.event_status !=
                                                                0
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                    (this.attendance_count_start_attendance =
                                                                        event.attendance_count),
                                                                        (this.id =
                                                                            event.event_id),
                                                                        (this.status = 1)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#startAttendanceModal">Start
                                                                        Attendance</a>
                                                                </li>
                                                            </div>
                                                            <div v-else-if="
                                                                event.attendance_status ==
                                                                1 &&
                                                                event.event_status ==
                                                                1 &&
                                                                event.event_status !=
                                                                0
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                        (this.attendance_count_start_attendance = 0),
                                                                        (this.id =
                                                                            event.event_id),
                                                                        (this.status = 2)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#stopAttendanceConfirmation">Stop
                                                                        Attendance</a>
                                                                </li>
                                                            </div>

                                                            <div>
                                                                <li>
                                                                    <a class="dropdown-item" data-bs-toggle="modal"
                                                                        data-bs-target="#cancelAttendance" @click="
                                                                        (this.id =
                                                                            event.event_id),
                                                                            this.fetchCancelAttendanceEvent()
                                                                            ">Exclude
                                                                        Attendance
                                                                        log</a>
                                                                </li>
                                                            </div>
                                                        </ul>
                                                    </div>
                                                    <!-- Card content -->
                                                    <h5 class="card-title mt-4 mb-2">
                                                        <strong>{{
                                                            event.name
                                                            }}</strong>
                                                    </h5>
                                                    <p class="card-subtitle text-muted">
                                                        Scheduled Date:
                                                        {{ event.start_date }}
                                                    </p>
                                                    <p class="card-subtitle text-muted">
                                                        Start Time:
                                                        {{
                                                            event.start_attendance
                                                        }}
                                                    </p>
                                                    <p class="card-subtitle text-muted">
                                                        End Time:
                                                        {{
                                                            event.end_attendance
                                                        }}
                                                    </p>
                                                    <h6 class="card-text mb-0">
                                                        Location:
                                                        {{ event.location }}
                                                    </h6>
                                                    <div class="d-flex justify-content-end">
                                                        <button class="btn btn-success" @click="
                                                            showEventDetails(
                                                                event.event_id
                                                            )
                                                            " data-bs-toggle="modal"
                                                            data-bs-target="#event-details-modal">
                                                            <i class="fas fa-eye"></i>
                                                            View
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Completed Events -->
                        <div class="col-12 accordion" id="eventAccordion">
                            <div class="accordion-item" v-if="completedEvents.length > 0">
                                <h2 class="accordion-header" id="newEventsHeading">
                                    <button class="accordion-button bg-white border rounded" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#completedEventsCollapse"
                                        aria-expanded="true" aria-controls="completedEventsCollapse">
                                        <i class="fas fa-bars" style="padding-right: 5px"></i>
                                        Completed Events
                                    </button>
                                </h2>
                                <div id="completedEventsCollapse" class="accordion-collapse collapse show"
                                    aria-labelledby="completedEventsHeading">
                                    <div class="accordion-body">
                                        <div class="d-flex row">
                                            <div v-for="event in completedEvents" :key="event.event_id"
                                                class="event-card" :class="[
                                                    'border-top',
                                                    'border-5',
                                                    {
                                                        'border-secondary':
                                                            event.event_status ===
                                                            0,
                                                        'border-warning':
                                                            event.event_status ===
                                                            1,
                                                        'border-success':
                                                            event.event_status ===
                                                            2,
                                                    },
                                                    'border-bottom-0',
                                                ]" :title="event.event_status === 0
                                                    ? 'New Event'
                                                    : event.event_status ===
                                                        1
                                                        ? 'Ongoing Event'
                                                        : 'Completed Event'
                                                    ">
                                                <!-- Event card HTML -->
                                                <div class="card">
                                                    <div class="dropdown"
                                                        v-if="this.user_school_year == this.school_year_input">
                                                        <a class="ellipsis-button" href="#" style="color: black"
                                                            role="button" id="ellipsisDropdown"
                                                            data-bs-toggle="dropdown" aria-expanded="false">
                                                            <i class="fas fa-ellipsis-h"></i>
                                                        </a>
                                                        <ul class="dropdown-menu" aria-labelledby="ellipsisDropdown">
                                                            <li>
                                                                <a class="dropdown-item" @click="
                                                                    FetchUpdateData(
                                                                        event.event_id
                                                                    )
                                                                    " data-bs-toggle="modal"
                                                                    data-bs-target="#event-modal">Edit
                                                                    Event</a>
                                                            </li>
                                                            <li>
                                                                <a class="dropdown-item" @click="
                                                                    this.id =
                                                                    event.event_id
                                                                    " data-bs-toggle="modal"
                                                                    data-bs-target="#deleteConfirmation">Delete
                                                                    Event</a>
                                                            </li>
                                                            <!-- option 3 -->
                                                            <!-- <li v-if="this.college_id != 11"><a class="dropdown-item"
                                            @click="this.id = (event.event_id), this.showYearLevelExempted()"
                                            data-bs-toggle="modal" data-bs-target="#exemptModal">Select Exempted Year
                                            Level</a>
                                    </li> -->
                                                            <div v-if="
                                                                event.event_status ==
                                                                0 ||
                                                                event.event_status ==
                                                                2
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                    (this.id =
                                                                        event.event_id),
                                                                        (this.status = 1)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#eventStatus">Start
                                                                        Event</a>
                                                                </li>
                                                            </div>
                                                            <div v-else-if="
                                                                event.event_status ==
                                                                1
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                    (this.id =
                                                                        event.event_id),
                                                                        (this.status = 2)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#eventStatus">Stop
                                                                        Event</a>
                                                                </li>
                                                            </div>
                                                            <div v-if="
                                                                (event.attendance_status ==
                                                                    0 ||
                                                                    event.attendance_status ==
                                                                    2) &&
                                                                event.event_status ==
                                                                1 &&
                                                                event.event_status !=
                                                                0
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                    (this.attendance_count_start_attendance =
                                                                        event.attendance_count),
                                                                        (this.id =
                                                                            event.event_id),
                                                                        (this.status = 1)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#startAttendanceModal">Start
                                                                        Attendance</a>
                                                                </li>
                                                            </div>
                                                            <div v-else-if="
                                                                event.attendance_status ==
                                                                1 &&
                                                                event.event_status ==
                                                                1 &&
                                                                event.event_status !=
                                                                0
                                                            ">
                                                                <li>
                                                                    <a class="dropdown-item" @click="
                                                                        (this.attendance_count_start_attendance = 0),
                                                                        (this.id =
                                                                            event.event_id),
                                                                        (this.status = 2)
                                                                        " data-bs-toggle="modal"
                                                                        data-bs-target="#stopAttendanceConfirmation">Stop
                                                                        Attendance</a>
                                                                </li>
                                                            </div>

                                                            <div>
                                                                <li>
                                                                    <a class="dropdown-item" data-bs-toggle="modal"
                                                                        data-bs-target="#cancelAttendance" @click="
                                                                        (this.id =
                                                                            event.event_id),
                                                                            this.fetchCancelAttendanceEvent()
                                                                            ">Exclude
                                                                        Attendance
                                                                        log</a>
                                                                </li>
                                                            </div>
                                                        </ul>
                                                    </div>
                                                    <!-- Card content -->
                                                    <h5 class="card-title mt-4 mb-2">
                                                        <strong>{{
                                                            event.name
                                                            }}</strong>
                                                    </h5>
                                                    <p class="card-subtitle text-muted">
                                                        Scheduled Date:
                                                        {{ event.start_date }}
                                                    </p>
                                                    <p class="card-subtitle text-muted">
                                                        Start Time:
                                                        {{
                                                            event.start_attendance
                                                        }}
                                                    </p>
                                                    <p class="card-subtitle text-muted">
                                                        End Time:
                                                        {{
                                                            event.end_attendance
                                                        }}
                                                    </p>
                                                    <h6 class="card-text mb-0">
                                                        Location:
                                                        {{ event.location }}
                                                    </h6>
                                                    <div class="d-flex justify-content-end">
                                                        <button class="btn btn-success" @click="
                                                            showEventDetails(
                                                                event.event_id
                                                            )
                                                            " data-bs-toggle="modal"
                                                            data-bs-target="#event-details-modal">
                                                            <i class="fas fa-eye"></i>
                                                            View
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- <div class="event-card border-top border-5 border-success border-bottom-0" v-for="event in this.filtered_events" :id="event.event_id" > -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Delete Confirmation Modal -->
                <div class="modal fade" id="deleteConfirmation" tabindex="-1" aria-labelledby="deleteConfirmationLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <!-- <h5 class="modal-title" id="deleteConfirmationLabel">Confirm Delete</h5> -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center">
                                <h4>
                                    <i class="fas fa-exclamation-triangle text-warning"></i>
                                </h4>
                                <h4><b>Delete Event</b></h4>
                                <p>
                                    Are you sure you want to delete this event?
                                </p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-danger" @click="deleteEvent()"
                                    data-bs-dismiss="modal">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Start event confirmation -->
                <div class="modal fade" id="eventStatus" tabindex="-1" aria-labelledby="eventStatusConfirmationLabel"
                    aria-hidden="true" role="dialog">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center">
                                <h4>
                                    <i v-if="status === 1" class="fas fa-question-circle text-warning"></i>
                                    <i v-if="status === 2" class="fas fa-exclamation-triangle text-danger"></i>
                                </h4>

                                <p v-if="this.status === 1">
                                    Are you sure you want to Start Event?
                                </p>
                                <p v-if="this.status === 2">
                                    Are you sure you want to Stop Event?
                                </p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cancel
                                </button>

                                <button type="button" class="btn btn-success" @click="startEvent()"
                                    :disabled="isSubmitting">
                                    <div v-if="this.status === 1">
                                        Start Event
                                    </div>
                                    <div v-else-if="this.status === 2">
                                        Stop Event
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Start Attendance confirmation -->
                <div class="modal fade" id="stopAttendanceConfirmation" tabindex="-1"
                    aria-labelledby="stopAttendanceConfirmationLabel" aria-hidden="true" role="dialog">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center">
                                <h4>
                                    <i v-if="status === 1" class="fas fa-question-circle text-warning"></i>
                                    <i v-if="status === 2" class="fas fa-exclamation-triangle text-danger"></i>
                                </h4>

                                <p v-if="this.status === 1">
                                    Are you sure you want to Start Attendance to
                                    this Event?
                                </p>
                                <p v-if="this.status === 2">
                                    Are you sure you want to Stop Attendance to
                                    this Event?
                                </p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cancel
                                </button>

                                <button type="button" class="btn btn-success" @click="startAttendance()"
                                    :disabled="isSubmitting">
                                    <div v-if="this.status === 1">
                                        Start Attendance
                                    </div>
                                    <div v-else-if="this.status === 2">
                                        Stop Attendance
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- start attendance modal -->
                <div class="modal fade" id="startAttendanceModal" tabindex="-1"
                    aria-labelledby="startAttendanceModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="text-center">
                                    <h4>
                                        <i class="fas fa-question-circle text-warning"></i>
                                    </h4>
                                    <h5 class="fw-bold text-center">
                                        Start an Attendance?
                                    </h5>
                                </div>
                                <!-- <p>Are you sure you want to start attendance?</p> -->
                                <label class="mt-2">Select Attendance Type:</label>
                                <div class="select-dropdown" style="
                                        width: 100% !important;
                                        border: 1px solid #ccc;
                                    ">
                                    <select id="sort-select" class="form-control" style="text-align: center"
                                        v-model="start_attendance.session" required>
                                        <option :value="0" disabled selected>
                                            Select Attendace Type
                                        </option>
                                        <option :value="1" v-if="
                                            attendance_count_start_attendance >=
                                            1
                                        ">
                                            Attendance log 1
                                        </option>
                                        <option :value="2" v-if="
                                            attendance_count_start_attendance >=
                                            2
                                        ">
                                            Attendance log 2
                                        </option>
                                        <option :value="3" v-if="
                                            attendance_count_start_attendance >=
                                            3
                                        ">
                                            Attendance log 3
                                        </option>
                                        <option :value="4" v-if="
                                            attendance_count_start_attendance >=
                                            4
                                        ">
                                            Attendance log 4
                                        </option>
                                    </select>
                                </div>
                                <div>
                                    <label class="mt-2">Schedule End Attendance:</label>
                                    <input type="time" name="start_attendance" class="form-control"
                                        id="event-start-time" v-model="start_attendance.end_session_scheduled_attendance
                                            " required />
                                </div>
                                <label for="select-dropdown" class="mt-2">Select Type</label>
                                <div class="d-flex gap-2">

                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="attendanceType" id="timeIn"
                                            value="Time-IN" v-model="start_attendance.attendance_log_started">
                                        <label class="form-check-label" for="timeIn">
                                            Time IN
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="attendanceType" id="timeOut"
                                            value="Time-Out" v-model="start_attendance.attendance_log_started">
                                        <label class="form-check-label" for="timeOut">
                                            Time OUT
                                        </label>
                                    </div>
                                </div>

                                <!-- <div class="form-group">
                                                    <label for="attendanceType">Select Attendance Type:</label>
                                                    <select class="form-select " id="attendanceType" v-model="session">
                                                        <option :value="1" v-if="attendance_count >= 1">Morning (Log in)</option>
                                                        <option :value="2" v-if="attendance_count >= 2">Morning (Log out)</option>
                                                        <option :value="3" v-if="attendance_count >= 3">Afternoon (Log in)</option>
                                                        <option :value="4" v-if="attendance_count >= 4">Afternoon (Log out)</option>
                                                    </select>
                                        </div> -->
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-success" @click="startAttendance()
                                    " :disabled="isSubmitting">
                                    Start
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- cancel attendance modal -->
                <div class="modal fade" id="cancelAttendance" tabindex="-1" aria-labelledby="cancelAttendanceModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="text-center">
                                    <h4>
                                        <i class="fas fa-question-circle text-warning"></i>
                                    </h4>
                                    <h5 class="fw-bold text-center">
                                        Exclude an Attendance?
                                    </h5>
                                </div>
                                <p>
                                    Select an attendance log that will not need
                                    an Attendance
                                </p>

                                <div v-for="index in this
                                    .attendance_count_for_exempting_attendance" :key="index">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input mr-2" :value="index"
                                            v-model="attendanceCancelled" />
                                        <label class="form-check-label fw-bold">Attendance Log {{ index
                                            }}</label>
                                    </div>
                                </div>

                                <!-- <div class="select-dropdown" style="width: 100% !important; border: 1px solid #ccc;"> -->
                                <!--
                                    <select id="sort-select" class="form-control" style="text-align: center;"
                                        v-model="session" required>
                                        <option :value="0" disabled selected>Select Attendace Type</option>
                                        <option :value="1" v-if="attendance_count_start_attendance >= 1">Morning (Log
                                            in)
                                        </option>
                                        <option :value="2" v-if="attendance_count_start_attendance >= 2">Morning (Log
                                            out)
                                        </option>
                                        <option :value="3" v-if="attendance_count_start_attendance >= 3">Afternoon (Log
                                            in)
                                        </option>
                                        <option :value="4" v-if="attendance_count_start_attendance >= 4">Afternoon (Log
                                            out)
                                        </option>
                                    </select> -->

                                <!-- </div> -->
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-success" @click="this.submitCancelAttendanceEvent">
                                    Submit
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Exempted Modal -->
                <div class="modal fade" id="exemptModal" tabindex="-1" role="dialog" aria-labelledby="exemptModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <form @submit.prevent="submitYearLevelExempted" ref="exemptForm">
                                <div class="modal-header">
                                    <!-- <h5 class="modal-title" id="exemptModalLabel">Exempted Year levels</h5> -->
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <h4 class="text-center fw-bold">
                                        <i class="fas fa-info-circle text-info"></i>
                                    </h4>
                                    <h5 class="text-center fw-bold">
                                        You are about to exclude a Year level
                                    </h5>
                                    <h6>
                                        Check the year level/s excused from
                                        required participation in the event
                                    </h6>
                                    <!-- <div v-if="!isAtLeastOneChecked" class="text-danger">Please select at least one year
                                        level</div> -->
                                    <div v-for="year_level in year_level_data" :key="year_level.id" class="form-check">
                                        <input type="checkbox" :value="year_level.id" v-model="year_level_exempted"
                                            class="form-check-input mr-2" />
                                        <label class="form-check-label fw-bold">{{ year_level.year_level }}
                                        </label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                        Close
                                    </button>
                                    <button type="submit" class="btn btn-success">
                                        Save
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- View modal -->
                <div class="modal fade" id="event-details-modal" tabindex="-1" role="dialog"
                    aria-labelledby="event-details-modal-label" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="event-details-modal-label">
                                    Event Details
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body" :id="this.showEvent.event_id">
                                <h5 class="card-title">
                                    <strong>{{
                                        this.showEvent["name"]
                                        }}</strong>
                                </h5>
                                <div class="mt-2 mb-3">
                                    <h6 class="card-text text-muted">
                                        <b> Scheduled Date: </b>
                                        {{ this.showEvent["start_date"] }}
                                    </h6>
                                    <h6 class="card-text text-muted">
                                        <b>Start Time: </b>
                                        {{ this.showEvent["start_attendance"] }}
                                    </h6>
                                    <h6 class="card-text text-muted">
                                        <b>End Time:</b>
                                        {{ this.showEvent["end_attendance"] }}
                                    </h6>

                                    <h6 class="card-text">
                                        <b>Location: </b>
                                        {{ this.showEvent["location"] }}
                                    </h6>
                                    <h6 class="card-text">
                                        <b>Description: </b>
                                        {{ this.showEvent["description"] }}
                                    </h6>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Copy Event modal -->
                <div class="modal fade" id="copy-modal" tabindex="-1" role="dialog"
                    aria-labelledby="event-details-modal-label" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="event-details-modal-label">
                                    Copy an Existing Event
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body" :id="this.showEvent.event_id">
                                <label for="select-dropdown">
                                    Select Semester to copy event from
                                </label>
                                <div class="select-dropdown border" style="width: 70%">
                                    <select id="sort-select" class="form-control" style="text-align: center"
                                        v-model="copy_event_data_school_year" @change="this.getEventsListToCopy">
                                        <option value="0" disabled selected>
                                            Select Semester
                                        </option>
                                        <option v-for="school_year in this
                                            .school_year" :value="school_year['id']">
                                            {{ school_year["semester"] }}
                                            {{ school_year["school_year"] }}
                                        </option>
                                    </select>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button class="btn btn-success">
                                        Select All
                                    </button>
                                </div>
                                <h5 class="text-center">
                                    Select Events you want to copy
                                </h5>
                                <div class="row" style="
                                        background-color: #f3f7fb;
                                        overflow-y: auto;
                                        max-height: 40vh;
                                    ">
                                    <div class="col mt-2" v-for="events in this.event_data_to_copy"
                                        :key="events.event_id">
                                        <label class="form-check">
                                            <input class="form-check-input" type="checkbox"
                                                v-model="this.copy_event_data_event_id" :value="events.event_id" />
                                            <div class="event-card border-top border-5 border-success"
                                                style="width: 18rem">
                                                <div class="card-body">
                                                    <h5 class="card-title">
                                                        Event Title :{{ events.name }}
                                                    </h5>
                                                    <p class="mb-0">Date : {{ events.start_date }}</p>
                                                    <p class="mb-0">
                                                        Start Time : {{ events.start_attendance }}
                                                    </p>
                                                    <p class="mb-0">End Time : {{ events.end_attendance }}</p>
                                                    <p class="mb-0">Location : {{ events.location }}</p>
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Close
                                </button>
                                <button type="button" class="btn btn-success" @click="this.submitCopyEvents()">
                                    Copy Events
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Event Modal -->
                <div class="modal fade" id="event-modal" tabindex="-1" aria-labelledby="event-modal-label"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <h5 v-if="this.submit == this.sendData" class="modal-title text-center fw-bold"
                                    id="event-modal-label">
                                    Create Event
                                </h5>
                                <h5 v-else-if="this.submit == this.UpdateData" class="modal-title text-center fw-bold"
                                    id="event-modal-label">
                                    Edit Event
                                </h5>

                                <form @submit.prevent="this.submit" id="eventsForm">
                                    <div class="mb-3">
                                        <label for="event-title" class="form-label">Event Name</label>
                                        <input type="text" name="name" class="form-control" id="event-title"
                                            v-model="formData.name" required maxlength="50" :style="{
                                                borderColor:
                                                    formData.name.length >= 50
                                                        ? 'red'
                                                        : '',
                                            }" />
                                        <p class="pl-2" v-if="formData.name.length >= 50" style="color: red">
                                            Maximum length reached
                                        </p>
                                    </div>
                                    <!-- <div class="row g-3">
                                            <div class="col-md-6"> -->
                                    <label for="event-start-date" class="form-label">Schedule Date</label>
                                    <input type="date" name="start_date" class="form-control" id="event-start-date"
                                        v-model="formData.start_date" required />
                                    <!-- </div> -->
                                    <!-- <div class="col-md-6">
                                                <label for="event-end-date" class="form-label">End Date</label>
                                                <input type="date" name="end_date" class="form-control" id="event-end-date" v-model="formData.end_date" required>
                                            </div> -->
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="event-start-time" class="form-label">Start Event
                                                Time</label>
                                            <input type="time" name="start_attendance" class="form-control"
                                                id="event-start-time" v-model="formData.start_attendance
                                                    " required />
                                        </div>
                                        <div class="col-md-6">
                                            <label for="event-end-time" class="form-label">End Event
                                                Time</label>
                                            <input type="time" name="end_attendance" class="form-control"
                                                id="event-end-time" v-model="formData.end_attendance
                                                    " required />
                                        </div>
                                    </div>
                                    <!-- </div> -->

                                    <div class="mb-3">
                                        <label for="event-location" class="form-label">Location</label>
                                        <input type="text" name="location" class="form-control" id="event-location"
                                            v-model="formData.location" required maxlength="30" :style="{
                                                borderColor:
                                                    formData.location.length >=
                                                        30
                                                        ? 'red'
                                                        : '',
                                            }" />
                                        <p class="pl-2" v-if="
                                            formData.location.length >= 30
                                        " style="color: red">
                                            Maximum length reached
                                        </p>
                                    </div>
                                    <div class="mb-3">
                                        <label for="event-description" class="form-label">Description</label>
                                        <span v-if="
                                            formData.description.length >
                                            200
                                        " class="text-danger">You have exceeded the word
                                            limit</span>
                                        <textarea class="form-control" name="description" id="event-description"
                                            rows="3" v-model="formData.description" required maxlength="200" :style="{
                                                borderColor:
                                                    formData.description
                                                        .length >= 200
                                                        ? 'red'
                                                        : '',
                                            }"></textarea>
                                        <p class="pl-2" v-if="
                                            formData.description.length >=
                                            200
                                        " style="color: red">
                                            Maximum length reached
                                        </p>
                                    </div>
                                    <!-- <div class="mb-3 flex justify-end">
                                        <div
                                            class="select-dropdown border"
                                            style="width: 80%"
                                        >
                                            <select
                                                id="sort-select"
                                                class="form-control"
                                                style="text-align: center"
                                                v-model="
                                                    this.formData
                                                        .evaluation_form
                                                "
                                                required
                                            >
                                                <option
                                                    value=""
                                                    disabled
                                                    selected
                                                >
                                                    Select Evaluation form
                                                </option>
                                                <option
                                                    v-for="evaluation in this
                                                        .evaluation_form"
                                                    :value="evaluation['id']"
                                                >
                                                    {{ evaluation['evaluation_title'] }}
                                                </option>
                                            </select>
                                        </div>
                                    </div> -->
                                    <div class="mb-3">
                                        <input class="form-check-input" type="checkbox" name="require_evaluation"
                                            id="require-evaluation" v-model="formData.require_evaluation"
                                            :true-value="1" :false-value="0" />
                                        <label for="require-evaluation" class="form-label" style="padding-left: 5px">Add
                                            Evaluation?</label>
                                    </div>
                                    <div v-if="formData.require_evaluation == 1" class="evaluation-content" style="
                                            padding-left: 15px;
                                            padding-right: 15px;
                                        ">
                                        <div class="d-flex gap-2">
                                            <!-- <div class="input-group col-md">
                                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                                <input class="form-control" list="datalistOptions" id="exampleDataList"
                                                    placeholder="Search Form..." />
                                            </div> -->
                                            <select id="sort-select" class="form-control" style="text-align: center"
                                                v-model="temporarySelectEvaluation">
                                                <option value="" disabled selected>
                                                    Select Evaluation form
                                                </option>
                                                <option v-for="evaluation in this
                                                    .evaluation_form" :value="evaluation['id']">
                                                    {{ evaluation['evaluation_title'] }}
                                                </option>
                                            </select>
                                            <button @click="this.addTemporaryEvaluation()" type="button"
                                                class="btn btn-primary">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>

                                        <h6 class="mt-2 fw-bold">
                                            Selected Evaluation Form/s
                                        </h6>
                                        <table class="table table-striped border rounded">
                                            <tbody>
                                                <tr v-for="evaluation in this.termporaryEvaluationDisplay">
                                                    <td>{{ evaluation.evaluation_title }}</td>
                                                    <td style="width: 20%">
                                                        <div class="d-flex gap-2">
                                                            <button @click="this.viewEvaluationModal(evaluation.id)"
                                                                type="button" class="btn btn-secondary"
                                                                data-bs-toggle="modal" data-bs-target="#previewModal">
                                                                <i class="fas fa-eye"></i>
                                                            </button>
                                                            <button @click="this.removeEvaluationForm(evaluation.id)"
                                                                type="button" class="btn btn-danger">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <!-- Add more rows as needed -->
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="mb-3">
                                        <input class="form-check-input" type="checkbox" name="require_attendance"
                                            id="require-attendance" v-model="formData.require_attendance
                                                " :true-value="1" :false-value="0" />
                                        <label for="require-attendance" class="form-label"
                                            style="padding-left: 5px">Require Attendance</label>
                                    </div>
                                    <div id="attendance-container" v-if="
                                        this.formData.require_attendance ==
                                        1
                                    ">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="event-attendance" class="form-label">Number of
                                                    Attendance
                                                    Log</label>
                                                <select name="attendance_count" class="form-select"
                                                    id="event-attendance" v-model="formData.attendance_count
                                                        " required>
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="fines" class="form-label">Fines Per
                                                    Attendance</label>
                                                <input type="number" name="fines" class="form-control" id="fines"
                                                    v-model="formData.fines" required />
                                            </div>
                                        </div>
                                    </div>
                                    <!-- <input type="hidden" name="org_id"  v-model="formData.org_id"> -->
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                            Close
                                        </button>
                                        <button type="submit" class="btn btn-success" id="save-event-button"
                                            :disabled="isSubmitting">
                                            Save
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- View Evaluation Form Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" v-for="evaluation in this.filteredEvaluationFormForModal">
                <div class="modal-header">
                    <!-- <h5 class="modal-title" id="exampleModalLabel">View Evaluation Form</h5> -->
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <div class="mb-3">
                        <h3 for="formTitle" class="form-label">Evalution name:{{ evaluation.evaluation_title }} </h3>
                    </div>
                    <div>
                        <label for="formDescription">Description:</label>
                        <p style="padding-left: 10px;"> {{ evaluation.evaluation_description }}</p>
                    </div>
                    <div class="mb-3" v-for="(question, index) in evaluation.evaluation_question">
                        <h5 for="question1" class="form-label fw-bold">Question {{ index + 1 }}</h5>
                        <div class="input-group">
                            <input type="text" class="form-control" id="question1" :value="question.description"
                                disabled readonly>
                        </div>
                        <div class="mb-3 form-check">
                            <div id="choicesContainer1" class="mt-2">
                                <h5 for="choices1 fw-bold">Choices</h5>
                                <div style="margin-left: 20px; margin-top: 10px">
                                    <p class="lh-1" v-for="(choices, index) in question.evaluation_option"> <b> {{
                                        choices.option }}</b> &nbsp; </p>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="feedback mb-3">
                        <label for="feedback">Accept Feedback? &nbsp; </label>
                        <small v-if="evaluation.is_accept_feedback == 0"> <b>No</b> </small>
                        <small v-else><b>Yes</b> </small>
                    </div>
                </div>
                <div class="modal-footer">

                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal"
                        data-bs-target="#event-modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
import { convertDate } from "../Functions/DateConverter.js";
import { toast } from "vue3-toastify";
import "vue3-toastify/dist/index.css";
import { converTime } from "../Functions/TimeConverter.js";

export default {
    props: ['organization_id', 'school_year_session', 'user_school_year'],
    data() {
        return {

            submit: this.sendData,
            events: [],
            showEvent: [],
            id: 0,
            status: 0,
            requireEvaluation: false,
            loading: false,
            formData: {
                name: "",
                start_date: "",
                start_attendance: "",
                end_attendance: "",
                location: "",
                description: "",
                require_attendance: 0,
                attendance_count: "",
                fines: "",
                org_id: this.organization_id,
                school_year_input: this.school_year_input,
                require_evaluation: 0,

            },
            temporary_evaluation_form: [],
            errors: {},
            school_year: [],
            school_year_input: this.school_year_session,
            searchTerm: "",
            status_filter: "",
            searchSchoolYear: 0,
            filtered_events: [],
            year_level_data: [],
            year_level_exempted: [],
            year_level_fetch_update: [],
            attendance_count_start_attendance: 0,
            start_attendance: {
                session: 0,
                end_session_scheduled_attendance: null,
                attendance_log_started: null,
            },

            evaluation_form: [],
            isSubmitting: false,
            attendance_count_for_exempting_attendance: 0,
            attendanceCancelled: [],
            college_id: 0,
            temporarySelectEvaluation: 0,
            termporaryEvaluationDisplay: [],
            filteredEvaluationFormForModal: [],

            //COPY EVENTS
            copy_event_data_school_year: null,
            copy_event_data_event_id: [],
            event_data_to_copy: []
        };
    },
    created() {
        this.loading = true;
        this.getOrgCollege();
        this.fetchData();
        this.showSchoolYear();
        this.showYearLevelData();
        this.getEventsListToCopy();


    },
    mounted() {

    },
    computed: {
        isAtLeastOneChecked() {
            return this.year_level_exempted.length > 0;
        },
        newEvents() {
            return this.filtered_events.filter(
                (event) => event.event_status === 0
            );
        },
        ongoingEvents() {
            return this.filtered_events.filter(
                (event) => event.event_status === 1
            );
        },
        completedEvents() {
            return this.filtered_events.filter(
                (event) => event.event_status === 2
            );
        },
    },

    methods: {
        viewEvaluationModal(evaluation_id) {
            console.log(evaluation_id)
            this.filteredEvaluationFormForModal = this.evaluation_form.filter(form => form.id === evaluation_id);
            console.log(this.filteredEvaluationFormForModal)
        },
        submitCopyEvents() {
            // console.log(this.copy_event_data_event_id)
            axios.post(`/submit_copy_events/${this.school_year_input}/${this.organization_id}`, this.copy_event_data_event_id)
                .then((response) => {
                    console.log(response.data);
                    this.showSucces(response.data.message)
                })
                .catch((error) => {
                    console.log(error);
                });
        },
        getEventsListToCopy() {
            axios
                .get(
                    `/events/show/${this.organization_id}/${this.copy_event_data_school_year}`
                )
                .then((response) => {
                    console.log(response.data)
                    this.event_data_to_copy = response.data;
                })
                .catch((error) => {
                    console.log(error);
                });
        },
        removeEvaluationForm(id) {
            console.log(this.termporaryEvaluationDisplay)
            //for the temporary view of the evaluation form
            const indexToRemove = this.termporaryEvaluationDisplay.findIndex(item => item.id === id);
            this.termporaryEvaluationDisplay.splice(indexToRemove, 1);

            //for the formdata
            const indexToRemove1 = this.termporaryEvaluationDisplay.findIndex(item => item.id === id);
            this.temporary_evaluation_form.splice(indexToRemove1, 1);
        },
        addTemporaryEvaluation() {
            // Check if the value already exists in the array
            if (!this.temporary_evaluation_form.includes(this.temporarySelectEvaluation)) {
                // Push the value into the array
                if (this.temporarySelectEvaluation != 0) {
                    this.temporary_evaluation_form.push(this.temporarySelectEvaluation);
                }

            }

            // Filter the evaluation_form array based on this.formData.evaluation_form
            this.termporaryEvaluationDisplay = this.evaluation_form.filter(item => {
                // Check if the id number is included in this.formData.evaluation_form
                return this.temporary_evaluation_form.includes(item.id);
            });

            console.log(this.temporary_evaluation_form)
        },
        getOrgCollege() {
            axios
                .get(`/get_organization_college/${this.organization_id}`)
                .then((response) => {
                    this.college_id = response.data;
                })
                .catch((error) => {
                    console.log(error);
                });
        },
        submitCancelAttendanceEvent() {
            // console.log(this.attendanceCancelled)
            axios
                .post(
                    `/submitCancelAttendanceEvent/${this.id}/${this.school_year_input}/${this.organization_id}`,
                    this.attendanceCancelled
                )
                .then((response) => {
                    this.showSucces(response.data.message);

                    console.log(response.data);
                })
                .catch((error) => {
                    alert(error);
                });
        },
        fetchCancelAttendanceEvent() {
            axios
                .get(`show_event_details/${this.id}`)
                .then((response) => {
                    console.log(response.data.events)
                    this.attendance_count_for_exempting_attendance =
                        response.data.events.attendance_count;
                    console.log(this.attendance_count_for_exempting_attendance);
                })
                .catch((error) => {
                    console.log(error);
                });

            axios
                .get(`show_cancelled_attendance/${this.id}`)
                .then((response) => {
                    this.attendanceCancelled = [];
                    response.data.forEach((element) => {
                        this.attendanceCancelled.push(element.session);
                    });
                    console.log(response.data);
                })
                .catch((error) => {
                    console.log(error);
                });
        },
        startEvent() {
            axios
                .post(`/update_event_status/${this.id}/${this.status}`)
                .then((response) => {
                    console.log(response.data);
                    this.showSucces(response.data.message);

                    // this.fetchData();
                })
                .catch((error) => {
                    alert("Error", error);
                });
        },
        showEvaluationForm() {
            axios
                .get(
                    `getEvaluationForm/${this.organization_id}/${this.school_year_input}`
                )
                .then((response) => {
                    console.log(response.data);
                    this.evaluation_form = response.data;
                })
                .catch((error) => { });
        },
        submitYearLevelExempted() {
            axios
                .post(
                    `/submitYearLevelExempted/${this.organization_id}/${this.school_year_input}/${this.id}`,
                    this.year_level_exempted
                )
                .then((response) => {
                    this.showSucces("Exempted Year Level Updated Successfully");

                    console.log(response.data);
                })
                .catch((error) => {
                    alert(error);
                });
        },
        showYearLevelData() {
            axios
                .get(`get_year_level/${this.organization_id}`)
                .then((response) => {
                    // console.log(response.data)
                    this.year_level_data = response.data;
                })
                .catch((error) => { });
        },
        showYearLevelExempted() {
            axios
                .get(`/yearLevel/exempted/${this.organization_id}/${this.id}`)
                .then((response) => {
                    // console.log(response.data)
                    let data = response.data;
                    this.year_level_exempted = [];
                    data.forEach((element) => {
                        // console.log(element)
                        // this.year_level_exempted = element.school_year;
                        this.year_level_exempted.push(element.year_level_id);
                    });
                    // this.year_level_exempted = response.data;
                })
                .catch((error) => {
                    console.log(error);
                });
        },
        filterItems() {
            // Filter based on searchTerm from textbox
            let filteredBySearch = this.events;
            if (this.searchTerm) {
                const searchTermLower = this.searchTerm.toLowerCase();
                filteredBySearch = filteredBySearch.filter((item) =>
                    item.name.toLowerCase().includes(searchTermLower)
                );
            }
            // Filter based on filterStatus from select option
            console.log(this.status_filter);
            let filteredByStatus = this.events;
            if (this.status_filter) {
                filteredByStatus = filteredByStatus.filter((item) =>
                    item.event_status.toString().includes(this.status_filter)
                );
            }

            // this.filtered_student_list = filteredBySearch;

            this.filtered_events = filteredBySearch.filter((item) =>
                filteredByStatus.includes(item)
            );
            // this.filtered_events = filteredBySearch;
        },
        showSchoolYear() {
            axios
                .get(`get_school_year`)
                .then((response) => {
                    // console.log(response.data)
                    this.school_year = response.data;
                })
                .catch((error) => {
                    console.log(error);
                });
        },
        showEventDetails(event) {
            console.log(event);
            axios
                .get(`show_event_details/${event}`)
                .then((response) => {
                    console.log(response.data)
                    const data = response.data.events;
                    // data.forEach(item => {
                    data["start_attendance"] = converTime(
                        data["start_attendance"]
                    );
                    data["end_attendance"] = converTime(data["end_attendance"]);
                    data["start_date"] = convertDate(data["start_date"]);
                    // });
                    console.log(data);
                    this.showEvent = data;
                })
                .catch((error) => { });
        },

        sendData() {

            // Assuming the checkboxes are already created as mentioned in your code snippet

            // Get all the checkboxes by their name
            const checkboxes = document.querySelectorAll(
                'input[name="checkboxes"]'
            );

            // Initialize an array to store the values of checked checkboxes
            const checkedValues = [];

            // Loop through each checkbox and check if it is checked
            checkboxes.forEach((checkbox) => {
                if (checkbox.checked) {
                    checkedValues.push(checkbox.value); // Add the value to the array if the checkbox is checked
                }
            });

            // Now, the checkedValues array contains the values of the checked checkboxes
            console.log("Checked values:", checkedValues);

            if (this.formData.require_evaluation == 1 && this.temporary_evaluation_form.length <= 0) {
                alert("Enter Evaluation Form");
            } else {
                this.isSubmitting = true;
                axios
                    .post("/add_event", { formData: this.formData, temporary_evaluation_form: this.temporary_evaluation_form })
                    .then((response) => {
                        this.showSucces(response.data.message);
                        console.log(response.data);
                    })
                    .catch((error) => {
                        alert(error);
                    });

            }
        },
        fetchData() {
            this.events = [];
            this.filtered_events = [];
            this.loading = true;

            axios
                .get(
                    `/events/show/${this.organization_id}/${this.school_year_input}`
                )
                .then((response) => {
                    console.log(response.data)
                    this.loading = false;
                    // document.getElementById("event-spinner").classList.add("hidden");
                    const data = response.data;
                    data.forEach((item) => {
                        item["start_attendance"] = converTime(
                            item["start_attendance"]
                        );
                        item["end_attendance"] = converTime(
                            item["end_attendance"]
                        );
                        item["start_date"] = convertDate(item["start_date"]);
                    });

                    this.events = response.data;
                    this.filtered_events = this.events;
                })
                .catch((error) => {
                    this.loading = false;
                    // this.loading = false;
                    console.log(error);
                });
            this.showEvaluationForm();
        },

        FetchUpdateData(id) {
            this.id = id;
            axios
                .get(`show_event_details/${id}`)
                .then((response) => {
                    let id = [];
                    if (response.data.event_evaluation.length > 0) {
                        response.data.event_evaluation.forEach(element => {
                            id.push(element.evaluation_form.id)
                        });

                        this.temporary_evaluation_form = id;
                        console.log('this is the id' + this.temporary_evaluation_form)
                        this.addTemporaryEvaluation();
                    }

                    // console.log(id)

                    this.formData = response.data.events;
                    this.submit = this.UpdateData;
                })
                .catch((error) => { });
        },
        UpdateData() {
            if (this.formData.require_evaluation == 1 && this.temporary_evaluation_form.length <= 0) {
                alert("Please Enter Evaluation Form");
            }
            else {
                this.isSubmitting = true;
                axios
                    .post(`/update_event/${this.id}`, { formData: this.formData, temporary_evaluation_form: this.temporary_evaluation_form })
                    .then((response) => {
                        this.submit = this.sendData;
                        console.log(response.data)
                        this.showSucces(response.data.message);
                    })
                    .catch((error) => {
                        // console.error('Error updating user:', error);
                        alert("Error updating user:", error);
                    });
            }

        },
        deleteEvent() {
            axios
                .post(`/delete_event/${this.id}`)
                .then((response) => {
                    console.log(response.data)
                    // const closeButton = $('.modal button[data-bs-dismiss="modal"]');
                    // closeButton.trigger('click');
                    if (response.data.status == 1) {
                        this.showSucces(response.data.message);
                        console.log(response.data);
                    } else {
                        this.showError(response.data.message);
                    }
                })
                .catch((error) => {
                    if (error.response && error.response.status === 422) {
                        this.errors = error.response.data.errors;
                    }
                    alert(error);
                });
        },

        startAttendance() {
            //get the current time
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');

            const currentTime = `${hours}:${minutes}`;

            if (this.start_attendance.session == 0 && this.status == 1 || this.start_attendance.end_session_scheduled_attendance == null && this.status == 1 || this.start_attendance.attendance_log_started == null && this.status == 1) {
                this.showError('Please Input Details')
            }
            else if (this.start_attendance.end_session_scheduled_attendance <= currentTime) {
                this.showError('End Attendance Time Scheduled is Earlier than Current Time')
            }
            else {
                axios
                    .post(
                        `/update_event_attendance_status/${this.id}/${this.status}`, this.start_attendance
                    )
                    .then((response) => {
                        this.isSubmitting = true;
                        console.log(response.data);
                        this.showSucces(response.data.message);

                        // this.fetchData();
                    })
                    .catch((error) => {
                        alert("Error", error);
                    });
            }
        },
        showSucces(message) {
            // this.fetchData();
            setTimeout(() => {
                location.reload();
            }, 500);
            toast.success(message),
            {
                autoClose: 100,
            };
        },
        showError(message) {
            // this.fetchData();
            toast.error(message),
            {
                autoClose: 100,
            };
        },
        initialData() {
            this.formData = {
                name: "",
                start_date: "",
                start_attendance: "",
                end_attendance: "",
                location: "",
                description: "",
                require_attendance: 0,
                attendance_count: "",
                fines: "",
                org_id: this.organization_id,
                school_year_input: this.school_year_input,
                require_evaluation: 0,

            };
        },
    },
};
</script>
